<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  

  
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" crossorigin="anonymous">
       <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" crossorigin="anonymous"></script>
  
    
         
    <style>  
        body {  
            font-family: Arial, sans-serif;  
            background-color: #222;  
            color: white;  
            margin: 0;  
            padding: 2px;  
        }  
  
        #player-container {  
            display: flex;  
            flex-direction: column;  
            align-items: center; 
        }  
  
        
  
        @keyframes text-gradient {  
            0%, 100% { background-position: 0% 50%; }  
            50% { background-position: 100% 50%; }  
        }  
  
        [data-shaka-player-container] video {  
            width: 100%;  
            max-width: 100%;  
            aspect-ratio: 16/9;  
            border-radius: 1px;  
            
            transition: box-shadow 0.2s ease;  
            object-fit: contain;  
            margin-bottom: 1px;  background:#000
        }  
  
        /* Hide neon effect in fullscreen on mobile */  
        @media (max-width: 768px) {  
            :fullscreen video {  
                box-shadow: none !important;  
            }  
        }  
  
        /* Ensure video fits screen in fullscreen */  
        :fullscreen [data-shaka-player-container] {  
            width: 100vw !important;  
            height: 100vh !important;  
            display: flex;  
            justify-content: center;  
            align-items: center;  
        }  
  
        :fullscreen video {  
            width: 100% !important;  
            height: 100% !important;  
            object-fit: contain !important;  
        }  
  
        #search-bar-container {  
            display: flex;  
            justify-content: space-between;  
            width: 100%;  
            margin: 2px 0;  
            gap: 0;  
        }  
  
        #search-bar {  
            width: 80%;  
            padding: 10px;  
            font-size: 16px;  
            background-color: rgba(255, 255, 255, 0.1);  
            border: none;  
            border-radius: 5px 0 0 5px;  
            color: white;  
            backdrop-filter: blur(5px);  
            transition: background-color 0.3s ease;  
        }  
  
        #search-bar:focus {  
            outline: none;  
            background-color: rgba(255, 255, 255, 0.2);  
        }  
  #neon-switch {  
            display: flex;  
            align-items: center;  
            width: 20%;  
        }  
  
        #neon-toggle {  
            cursor: pointer;  
            padding: 10px;  
            border: 1px solid #555;  
            border-radius: 0 5px 5px 0;  
            background-color: rgba(255, 255, 255, 0.1);  
            color: white;  
            transition: background-color 0.3s ease, color 0.3s ease;  
            width: 100%;  
            text-align: center;  
        }  
  
        #neon-toggle.active {  
            background-color: ;  
            color: white;  
        }  
        
  
        #channel-list-container {  
            width: 100%;  
            max-height: 400px;  
            overflow-y: scroll;  
            scrollbar-width: thin;  
        }  
  
        #channel-list {  
            display: grid;  
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));  
            gap: 2px;  
            width: 100%;  
            margin-top: 20px;  
        }  
  
        .channel-tile {  
            display: flex;  
            flex-direction: column;  
            align-items: center;  
            padding: 10px;  
            cursor: pointer;  
            background-color: #333;  
            border-radius: 10px;  
            transition: transform 0.2s;  
        }  
  
        .channel-tile:hover {  
            transform: scale(1.05);  
            background-color: #444;  
        }  
  
        .channel-tile img {  
            width: 50px;  
            height: 60px;  
            margin-bottom: 5px;  
            border-radius: 4px;  
        }  
  
        .channel-name {  
            font-size: 10px;  
            text-align: center;  
        }  
  
        #loading {  
            color: yellow;  
            margin: 20px 0;  
            display: none;  
        }  
  

  
        
        @keyframes pulse {  
            0% { transform: scale(1); }  
            50% { transform: scale(1.05); }  
            100% { transform: scale(1); }  
        }  


    </style>  
</head>
        
        <div data-shaka-player-container="" style="width: 100%; cursor: none;" class="shaka-mobile shaka-video-container" shaka-controls="true">  
            <video data-shaka-player="" id="video" autoplay="" muted="" playsinline="" preload="metadata" class="shaka-video" src=""></video>  
        <div class="shaka-text-container" style="text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: flex-end;"></div></div>  
  
        <div id="search-bar-container">  
            <input type="text" id="search-bar" placeholder="Search for channels..." onkeyup="filterChannels()">  
            <div id="neon-switch">  
                <div id="neon-toggle" class="" onclick="toggleNeon()">GO</div>  
            </div>  
        </div>  
  
        <div id="loading" style="display: none;">Loading channels...</div>  
        <div id="channel-list-container">  
            <div id="channel-list"></div></div>  
       



<script>
    // Update timestamp once
    function updateTimestamp() {
        try {
            document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString('en-US', {
                timeZone: 'Asia/Kolkata',
                hour12: true
            });
        } catch (error) {
            console.error('Timestamp error:', error.message);
            document.getElementById('lastUpdated').textContent = 'Err';
        }
    }

    // Ping PHP script once via fetch
    function pingBackground() {
        fetch('')
            .then(response => {
                console.log('Pinged sgautodaily.php successfully');
            })
            .catch(error => {
                console.error('Ping failed:', error.message);
            });
    }

    document.addEventListener('DOMContentLoaded', () => {
        updateTimestamp();
        pingBackground();
    });
</script>


    </div>



<script>  
        let neonActive = true;  
        let player;  
        let sharedHdnea = ''; // Variable to store the cookie from M3U

        // Initialize Shaka Player  
        async function initPlayer() {  
            shaka.polyfill.installAll();  
            if (!shaka.Player.isBrowserSupported()) {  
                console.error('Browser not supported');  
                return;  
            }  

            const video = document.getElementById('video');  
            player = new shaka.Player(video);  
            const ui = new shaka.ui.Overlay(player, document.querySelector('[data-shaka-player-container]'), video);  
            ui.getControls();  

            player.configure({  
                drm: {  
                    clearKeys: {} // Will be set per channel in playChannel  
                },  
                streaming: {  
                    bufferingGoal: 10,  
                    rebufferingGoal: 2,  
                    bufferBehind: 15,  
                    retryParameters: {  
                        timeout: 15000,  
                        maxAttempts: 5,  
                        baseDelay: 500,  
                        backoffFactor: 1.2  
                    },  
                    segmentRequestTimeout: 8000,  
                    useNativeHlsOnSafari: true,  
                    lowLatencyMode: true,  
                    jumpLargeGaps: true,  
                    inaccurateManifestTolerance: 0.5  
                },  
                manifest: {  
                    retryParameters: {  
                        timeout: 10000,  
                        maxAttempts: 3  
                    }  
                }  
            });  

            player.getNetworkingEngine().registerRequestFilter((type, request) => {  
                request.headers['Referer'] = 'https://www.jiotv.com/';  
                request.headers['User-Agent'] = "plaYtv/7.1.5 (Linux;Android 13) ExoPlayerLib/2.11.6";  
                // Cookie is set per channel in playChannel  
            });  

            player.addEventListener('error', (event) => {  
                console.error('Shaka Player Error:', event.detail);  
            });  

            video.addEventListener('play', () => {  
                if (!document.fullscreenElement) {  
                    document.querySelector('[data-shaka-player-container]').requestFullscreen().catch(() => {});  
                }  
            }, { once: true });  
        }  

        // Toggle neon effect  
        function toggleNeon() {  
            const video = document.getElementById('video');  
            const toggleButton = document.getElementById('neon-toggle');  

            if (neonActive) {  
                video.style.boxShadow = 'none';  
                toggleButton.classList.remove('active');  
            } else {  
                video.style.boxShadow = '0 0 15px var(--neon-color, #00f), 0 0 30px var(--neon-color, #00f), 0 0 45px var(--neon-color, #f0f), 0 0 60px var(--neon-color, #f0f)';  
                toggleButton.classList.add('active');  
            }  
            neonActive = !neonActive;  

            if (navigator.vibrate) {  
                navigator.vibrate(100);  
            }  
        }  

        // Fetch and parse M3U  
        async function fetchM3U() {  
            try {  
                const response = await fetch('https://raw.githubusercontent.com/abusaeeidx/Yupptv-Playlist/refs/heads/main/playlist.m3u');  
                const m3uText = await response.text();  
                return parseM3U(m3uText);  
            } catch (error) {  
                console.error('Error fetching M3U:', error);  
                return [];  
            }  
        }  

        function parseM3U(m3uText) {  
            const lines = m3uText.split('\n').map(line => line.trim());  
            const channels = [];  
            let currentChannel = null;  

            for (const line of lines) {  
                if (line.startsWith('#EXTM3U')) {  
                    continue;  
                } else if (line.startsWith('#EXTINF:')) {  
                    currentChannel = {};  
                    const match = line.match(/tvg-id="([^"]+)"\s+tvg-chno="([^"]+)"\s+tvg-name="([^"]+)"\s+tvg-logo="([^"]+)"\s+group-title="([^"]+)"\s*,(.+)/);  
                    if (match) {  
                        currentChannel.name = match[6];  
                        currentChannel.logo = match[4];  
                    }  
                } else if (line.startsWith('#EXTVLCOPT:http-user-agent=')) {  
                    if (currentChannel) {  
                        currentChannel.userAgent = line.replace('#EXTVLCOPT:http-user-agent=', '');  
                    }  
                } else if (line.startsWith('#EXTHTTP:')) {  
                    const httpMatch = line.match(/"cookie":"__hdnea__=(.+)"/);  
                    if (httpMatch && currentChannel) {  
                        currentChannel.hdnea = httpMatch[1];  
                        sharedHdnea = httpMatch[1]; // Store the cookie for custom channels  
                    }  
                } else if (line && !line.startsWith('#') && currentChannel) {  
                    currentChannel.url = line;  
                    channels.push(currentChannel);  
                    currentChannel = null;  
                }  
            }  
            return channels;  
        }  

        // Define custom channels  
        const customChannels = [  
            
        ];  

        // Load channels into grid  
        async function loadChannels() {  
            const loadingDiv = document.getElementById('loading');  
            loadingDiv.style.display = 'block';  

            const m3uChannels = await fetchM3U();  
            // Update custom channels with the fetched cookie  
            customChannels.forEach(channel => {  
                channel.hdnea = sharedHdnea;  
            });  
            // Combine M3U channels with custom channels (M3U first, then custom)  
            const channels = [...m3uChannels, ...customChannels];  
            loadingDiv.style.display = 'none';  
            const channelList = document.getElementById('channel-list');  

            if (channels.length === 0) {  
                channelList.innerHTML = '<div>No channels found.</div>';  
                return;  
            }  

            const initialChannel = channels[0];  
            await playChannel(initialChannel);  

            channels.forEach((channel, index) => {  
                const tile = document.createElement('div');  
                tile.classList.add('channel-tile');  
                const logoImg = document.createElement('img');  
                logoImg.src = channel.logo || 'https://via.placeholder.com/80';  
                const channelName = document.createElement('div');  
                channelName.classList.add('channel-name');  
                channelName.textContent = channel.name;  
                tile.appendChild(logoImg);  
                tile.appendChild(channelName);  
                tile.onclick = () => playChannel(channel);  
                channelList.appendChild(tile);  
            });  
        }  

        // Play selected channel  
        async function playChannel(channel) {  
            if (!player) await initPlayer();  

            player.configure({  
                drm: {  
                    clearKeys: {  
                        [channel.mod]: channel.key  
                    }  
                }  
            });  

            player.getNetworkingEngine().clearAllRequestFilters();  
            player.getNetworkingEngine().registerRequestFilter((type, request) => {  
                request.headers['Referer'] = 'https://www.jiotv.com/';  
                request.headers['User-Agent'] = channel.userAgent || "plaYtv/7.1.5 (Linux;Android 13) ExoPlayerLib/2.11.6";  
                request.headers['Cookie'] = `__hdnea__=${channel.hdnea || ''}`;  

                if ((type === shaka.net.NetworkingEngine.RequestType.MANIFEST ||   
                     type === shaka.net.NetworkingEngine.RequestType.SEGMENT) &&   
                    request.uris[0].indexOf('__hdnea__=') === -1) {  
                    const separator = request.uris[0].includes('?') ? '&' : '?';  
                    request.uris[0] += separator + `__hdnea__=${channel.hdnea || ''}`;  
                }  
            });  

            try {  
                await player.load(channel.url);  
                const video = document.getElementById('video');  
                const playVideo = async () => {  
                    try {
                        // First attempt: Try unmuted autoplay  
                        video.muted = false;  
                        await video.play();  
                        console.log('Unmuted autoplay successful');  
                    } catch (playError) {  
                        console.log('Unmuted autoplay failed, trying muted play:', playError);  
                        // Fallback to muted autoplay  
                        video.muted = true;  
                        await video.play();  
                        console.log('Muted autoplay successful');  
                        // Attempt to unmute after muted success if allowed  
                        try {  
                            video.muted = false;  
                            await video.play();  
                            console.log('Unmuted after muted successful');  
                        } catch (unmuteError) {  
                            console.log('Unmute after muted failed, requires user interaction:', unmuteError);  
                        }  
                    }  
                };  
                if (video.readyState >= 3) await playVideo();  
                else video.addEventListener('canplay', playVideo, { once: true });  
            } catch (error) {  
                console.error('Load error:', error);  
            }  
        }  

        // Filter channels  
        function filterChannels() {  
            const searchValue = document.getElementById('search-bar').value.toLowerCase();  
            const channelTiles = document.querySelectorAll('.channel-tile');  
            channelTiles.forEach(tile => {  
                const channelName = tile.querySelector('.channel-name').textContent.toLowerCase();  
                tile.style.display = channelName.includes(searchValue) ? '' : 'none';  
            });  
        }  

        window.onload = async () => {  
            await loadChannels();  
        };  
  </script>
